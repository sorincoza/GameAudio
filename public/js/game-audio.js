"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),a=i(2);window.GameAudioPlayer=n.a,window.GameAudioSpritePlayer=a.a},function(e,t,i){function n(){var e="/",t=window.location.href.split(e);return t[t.length-1].indexOf(".html")?t[t.length-1]="":t[t.length]="",t.join(e)}function a(e){var t=n();return t=l(t,"/")+"/",e=e?l(e,"/"):"",t+e}function s(e){return e.indexOf("//")<0&&(e=a(e)),e}function r(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function l(e,t){t=r(t);var i=new RegExp("^["+t+"]+|["+t+"]+$","g");return e.replace(i,"")}var o=function(){function e(t,i){_classCallCheck(this,e),this.SOUND_NAME=t,this.loop=!1,this._isPlaying=!1,this.loopListenerIsSetUp=!1,this.CACHE={player:{},src:""},this.load(),this._onReadyCb=!!i.onLoad&&i.onLoad,this._spriteInterval=null,this._wasPrePlayed=!1,this._isPreplaying=!1,i.preload&&this.setUpEarliestPrePlay()}return _createClass(e,[{key:"reset",value:function(){this.CACHE.player=this.getNewAudio()}},{key:"load",value:function(){var e=this,t="undefined"!=typeof XMLHttpRequest&&new XMLHttpRequest,i=t&&void 0!==t.responseType,n=s(this.SOUND_NAME);i?(t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(e.CACHE.src=window.URL.createObjectURL(t.response),e.CACHE.player=e.getNewAudio(),e._playbackEnd_Watchers(),e._executeOnLoad())},t.open("GET",n),t.responseType="blob",t.send()):(this.CACHE.src=n,this.CACHE.player=this.getNewAudio(),this._playbackEnd_Watchers())}},{key:"play",value:function(){var e=this.CACHE.player;e.play&&(this._isPreplaying&&(e.pause(),this._isPreplaying=!1),this._wasPrePlayed&&(e.muted=!1),e.play(),this._isPlaying=!0)}},{key:"playSprite",value:function(e,t){this.CACHE.player.play&&(null!==e&&t&&(this._clearSpriteInterval(),this.setUpSpritePlay(e,t)),this.play())}},{key:"playLoop",value:function(){this.loop=!0,void 0!==this.CACHE.player.loop?this.CACHE.player.loop=!0:this.setupLoop(),this.play()}},{key:"pause",value:function(){var e=this.CACHE.player;e.pause&&(e.pause(),this._clearSpriteInterval(),this._destroyLoop(),this._isPlaying=!1)}},{key:"playAsync",value:function(){this.playNewAudio()}},{key:"_executeOnLoad",value:function(){this._onReadyCb&&(this._onReadyCb(this),this._onReadyCb=!1)}},{key:"isPlaying",value:function(){return this._isPlaying}},{key:"getNewAudio",value:function(){var e=new window[this.AUDIO_PLATFORM];return this.CACHE.src&&(e.src=this.CACHE.src),this.loop&&(e.loop=!0),e}},{key:"playNewAudio",value:function(){this.getNewAudio().play()}},{key:"setupLoop",value:function(){this.loopListenerIsSetUp||(this.CACHE.player.onended=function(){this.currentTime=0,this.play()},this.loopListenerIsSetUp=!0)}},{key:"_destroyLoop",value:function(){this.CACHE.player.onended=null,this.loopListenerIsSetUp=!1,this.loop=!1}},{key:"setUpEarliestPrePlay",value:function(){var e=this,t=function t(){e._wasPrePlayed||e._isPreplaying||!e.CACHE.player.play||(e.CACHE.player.muted=!0,e.play(),e._isPreplaying=!0,e._wasPrePlayed=!0,window.removeEventListener("click",t))};window.addEventListener("click",t)}},{key:"setUpSpritePlay",value:function(e,t){var i=this,n=this.CACHE.player,a=e||0,s=t||1e3,r=25,l=Math.ceil(1e3*(s-a)/r),o=0;if(n.play){n.currentTime=a;var u=function(){o++,o>=l&&i.pause(),n.currentTime>=s&&(i.loop?i.playSprite(a,s):i.pause())};this._spriteInterval=setInterval(u,r)}}},{key:"_clearSpriteInterval",value:function(){this._spriteInterval&&clearInterval(this._spriteInterval)}},{key:"_playbackEnd_Watchers",value:function(){var e=this,t=function(){e.loop||e.pause()};this.CACHE.player.addEventListener("ended",t)}},{key:"AUDIO_PLATFORM",get:function(){return"Audio"}},{key:"volume",set:function(e){this.CACHE.player.volume=e}},{key:"autoplay",set:function(e){this.CACHE.player.volume=e}}]),e}();t.a=o},function(e,t,i){var n=function(){function e(t,i,n){_classCallCheck(this,e),this.GameAudioPlayer=t||!1,this.TIME={start:i||0,end:n||1e3},this._isPlaying=!1}return _createClass(e,[{key:"reset",value:function(){}},{key:"play",value:function(){this.GameAudioPlayer.playSprite(this.TIME.start,this.TIME.end),this._isPlaying=!0}},{key:"playLoop",value:function(){this.GameAudioPlayer.loop=!0,this.play()}},{key:"pause",value:function(){this.GameAudioPlayer.pause(),this._isPlaying=!1}},{key:"isPlaying",value:function(){return this._isPlaying&&this.GameAudioPlayer.isPlaying()}},{key:"loop",set:function(e){this.GameAudioPlayer.loop=!!e}}]),e}();t.a=n}]);